<div class="home">
	<div id="map"></div>
	<div id="login-div" class="registration-floating-div float-div hidden">
		<%= erb :"/sessions/_login.html" %>
	</div>
	<div id="register-div" class="registration-floating-div float-div hidden">
		<%= erb :"/users/_new.html" %>
	</div>
</div>
<script>
var dbc = {lat: 37.7846334, lng: -122.3996024};

function initMap() {
	map = new google.maps.Map($("#map")[0], {
		zoom: 12,
		center: dbc,
		mapTypeControl: true,
		panControl: false,
		zoomControl: false,
		streetViewControl: false
	});

	autocomplete = new google.maps.places.Autocomplete(
			/** @type {!HTMLInputElement} */ (
			$("#search")[0]), {
				types: ['(cities)']
			});
	places = new google.maps.places.PlacesService(map);

	autocomplete.addListener('place_changed', onPlaceChanged);

	<% if @places %>
		<% @places.each do |place| %>
			var marker = new google.maps.Marker({
				position: { lat: <%= place.lat %>, lng: <%= place.lng %> },
				animation: google.maps.Animation.DROP,
				map: map
			});
		<% end %>
	<% end %>

	var infoWindow = new google.maps.InfoWindow({map: map});

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      var content = '<a>Example Text</a>'
      infoWindow.setPosition(pos);
      infoWindow.setContent(content);
      map.setCenter(pos);
    });
  };
};

// var marker = new google.maps.Marker({
// 	position: place.geometry.location,
// 	animation: google.maps.Animation.DROP,
// 	map: map
// });

// When the user selects a city, get the place details for the city and
// zoom the map in on the city.
function onPlaceChanged() {
	var place = autocomplete.getPlace();
	console.log(place)
	if (place.geometry) {
		map.panTo(place.geometry.location);
		map.setZoom(12);
	} else {
		document.getElementById('search').placeholder = 'SEARCH';
	}

	new google.maps.Marker({
		position: place.geometry.location,
		animation: google.maps.Animation.DROP,
		map: map
	});
};
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= @api_key %>&callback=initMap&libraries=places" async defer>
</script>
